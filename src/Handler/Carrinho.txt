{-# LANGUAGE NoImplicitPrelude #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE TypeFamilies, DeriveGeneric #-}

module Handler.Carrinho where

import Import
import Network.HTTP.Types.Status
import Database.Persist.Postgresql

-- /fornecedor                         FornecedorR           GET
-- /fornecedor/cadastrar               CadastrarFornecedorR  GET POST
-- /fornecedor/listar                  ListarFornecedorR     GET
-- /fornecedor/buscar/#FornecedorId    BuscarFornecedorR     GET
-- /fornecedor/editar/#FornecedorId    EditarFornecedorR     PUT
-- /fornecedor/excluir/#FornecedorId   ExcluirFornecedorR    POST

-- Fornecedor json
--     cnpj              Text
--     nomeEmpresa       Text
--     nome              Text  
--     email             Text  
--     telefonecomercial Text  
--     cargo             Text  
--     Uniquecnpj        cnpj
--     deriving Show

-- formulário de Cadastro de Fornecedores
-- formCarrinho :: Form Carrinho
-- formCarrinho = renderDivs $ Carrinho
--     <$> areq (selectField $ optionsPersistKey [] [] clienteNome) FieldSettings{fsId=Just "txtCliente",
--                                       fsLabel="Cliente: ",
--                                       fsTooltip= Nothing,
--                                       fsName= Nothing,
--                                       fsAttrs=[("class","form-control")]} Nothing
--     <*> areq (selectField $ optionsPersistKey [] [] produtoNome) FieldSettings{fsId=Just "txtProduto",
--                                       fsLabel="Nome do Produto: ",
--                                       fsTooltip= Nothing,
--                                       fsName= Nothing,
--                                       fsAttrs=[("class","form-control")]} Nothing
    
    
-- <*> areq (selectField $ optionsPersistKey [] [] tipousuarioDescricao) "Tipo Usuario: " Nothing
-- <*> (fmap toSqlKey $ areq intField "Tipo Usuario" Nothing)

-- getPerfilCarrinhoR :: ClienteId -> Handler Html
-- getPerfilCarrinhoR carrinhoid = do 
--     carrinho <- runDB $ get404 carrinhoid
--     defaultLayout $ do 
--         [whamlet|
--             <h1> ]
--                 Cliente: #{carrinhoCliente carrinho}
--             <h2>
--                 Produto: #{carrinhoProduto carrinho} 
--             <a href=@{HomeR}> Voltar

-- <a href=@{PerfilCarrinhoR carrinhoid}> 

getCarrinhoR :: Handler Html
getCarrinhoR = do
    defaultLayout $ do
        toWidget [lucius|
            li {
                display: inline-block;
                list-style:  none;
            }
            
        |]
        [whamlet|
            <h1> Carrinhos
            <ul>
                <li> <a href=@{ListarCarrinhoR}>  Listar Carrinho
                <li> <a href=@{HomeR}>  Home
        |]

-- essa função pega um formulário (FormCarrinho) e gera um Handler 
-- com uma tupla de "Widget" para campos do formulario e um "enctype" para String.
-- getCadastrarCarrinhoR :: Handler Html
-- getCadastrarCarrinhoR = do
--     (widget,enctype) <- generateFormPost formCarrinho
--     defaultLayout $ do
--         addStylesheet $ (StaticR css_bootstrap_css)
--         --addStylesheet $ (StaticR css_temas_css)
--         addScript $ (StaticR js_jquery_min_js)
--         addScript $ (StaticR js_bootstrap_min_js)
--         --corpo html
--         -- $(whamletFile "templates/home.hamlet")
--         toWidget [lucius|
--             .logo-menu 
--             {
--                 float: left;
--                 width: 140px;
--                 margin-top: -10px;
--             }
--             .btn-sair 
--             {
--                 float: right;
--                 margin-top: 8px;
--             }
--             .required
--             {
--                 width: 200px;
--                 float: left;
--                 padding: 10px;
--             }
--             .btn-area
--             {
--                 width: 100%;
--                 float: left;
--             }
--             .btn-enviar
--             {
--                 float: right;
--             }
--         |]     
--         [whamlet|
--             <meta name="viewport" content="width=device-width, initial-scale=1">
--             <nav class="navbar navbar-inverse">
--                 <div class="container">
--                     <div class="navbar-header">
--                         <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
--                             <span class="sr-only">
--                                 Toggle navigation
--                             <span class="icon-bar">
--                             <span class="icon-bar">
--                             <span class="icon-bar">
--                         <a class="navbar-brand" href="#">
--                             <img src="../../static/img/logo-2.png" class="logo-menu" />
--                     <div id="navbar" class="collapse navbar-collapse">
--                         <ul class="nav navbar-nav">
--                             <li class="dropdown">
--                                 <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
--                                     Produtos
--                                     <span class="caret">
--                                 <ul class="dropdown-menu">
--                                     <li>
--                                         <a href=@{CadastrarProdutoR}>
--                                             Cadastro de Produtos
--                                     <li>
--                                         <a href=@{ListarProdutoR}>
--                                             Listagem de Produtos
--                             <li class="dropdown">
--                                 <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
--                                     Categorias
--                                     <span class="caret">
--                                 <ul class="dropdown-menu">
--                                     <li>
--                                         <a href=@{CadastrarCategoriaR}>
--                                             Cadastro de Categorias
--                                     <li>
--                                         <a href=@{ListarCategoriaR}>
--                                             Listagem de Categorias 
--                             <li class="dropdown">
--                                 <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
--                                     Carrinhos
--                                     <span class="caret">
--                                 <ul class="dropdown-menu">
--                                     <li>
--                                         <a href=@{CadastrarCarrinhoR}>
--                                             Cadastro de Carrinhos
--                                     <li>
--                                         <a href=@{ListarCategoriaR}>
--                                             Listagem de Carrinhos                                            
--                             <li> 
--                                 <a href=@{UsuarioR}> Cadastro de Usuarios
--                                     <li>
--                                         <form action=@{LogoutR} method=post>
--                                             <button type="submit" value="" class="btn btn-danger btn-sair">
--                                                 Sair
--                                                 <span class="glyphicon glyphicon-remove" aria-hidden="true">                        
                                            
                                                
--             <div class="container">   
--                 <div class="panel panel-default">
--                     <div class="panel-heading">
--                         <span class="glyphicon glyphicon-download-alt" aria-hidden="true">
--                         Cadastro de Produtos        
--                     <div class="panel-body">
--                         <form action=@{CadastrarCarrinhoR} method=post>
--                             ^{widget}
--                             <div class="btn-area">
--                                 <button type="submit" value="" class="btn btn-success btn-enviar">
--                                     Cadastrar
--                                     <span class="glyphicon glyphicon-plus" aria-hidden="true">                        
--         |]
    

getListarCarrinhoR :: Handler Html
getListarCarrinhoR = do
    carrinhos <- runDB $ selectList [] [Asc CarrinhoCliid]
    defaultLayout $ do
        addStylesheet $ (StaticR css_bootstrap_css)
        --addStylesheet $ (StaticR css_temas_css)
        addScript $ (StaticR js_jquery_min_js)
        addScript $ (StaticR js_bootstrap_min_js)
        --corpo html
        -- $(whamletFile "templates/home.hamlet")
        toWidget [lucius|
            .logo-menu 
            {
                float: left;
                width: 140px;
                margin-top: -10px;
            }
            .btn-sair 
            {
                float: right;
                margin-top: 8px;
            }
            .btn-excluir 
            {
                float: right;
            }                
        |]      
        [whamlet|
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <nav class="navbar navbar-inverse">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">
                                Toggle navigation
                            <span class="icon-bar">
                            <span class="icon-bar">
                            <span class="icon-bar">
                        <a class="navbar-brand" href="#">
                            <img src="../../static/img/logo-2.png" class="logo-menu" />
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    Produtos
                                    <span class="caret">
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href=@{CadastrarProdutoR}>
                                            Cadastro de Produtos
                                    <li>
                                        <a href=@{ListarProdutoR}>
                                            Listagem de Produtos
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    Categorias
                                    <span class="caret">
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href=@{CadastrarCategoriaR}>
                                            Cadastro de Categorias
                                    <li>
                                        <a href=@{ListarCategoriaR}>
                                            Listagem de Categorias 
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    Fornecedores
                                    <span class="caret">
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href=@{CadastrarFornecedorR}>
                                            Cadastro de Fornecedores
                                    <li>
                                        <a href=@{ListarCategoriaR}>
                                            Listagem de Fornecedores                                            
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    Funcionários
                                    <span class="caret">
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href=@{CadastrarUsuarioR}>
                                            Cadastro de Funcionários
                                    <li>
                                        <a href=@{ListarUsuarioR}>
                                            Listagem de Funcionários  
                            <li>
                                <form action=@{LogoutR} method=post>
                                    <button type="submit" value="" class="btn btn-danger btn-sair">
                                        Sair
                                        <span class="glyphicon glyphicon-remove" aria-hidden="true">                        
                                            
                                                
            <div class="container">   
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-th-list" aria-hidden="true">
                        Listagem de Fornecedores
        
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    Nome do Cliente
                                <th>
                                    Produto
                        <tbody>
                            $forall (Entity carrinhoid carrinho) <- carrinhos
                                <tr>
                                    <td>
                                        #{carrinhoCliid carrinho}
                                    <td>
                                        #{carrinhoProid carrinho}
        |]

